<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CompraDirectaDSM - Compra Directa, Soluciones Confiables</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #ffffff;
            background: #0a0a0a;
            min-height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 123, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 50%);
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 136, 0.9);
            color: black;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .connection-status.offline {
            background: rgba(255, 193, 7, 0.9);
        }

        .connection-status.error {
            background: rgba(255, 68, 68, 0.9);
            color: white;
        }

        /* Sync Status */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 123, 255, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            transition: all 0.3s ease;
        }

        .sync-status.show {
            display: block;
        }

        .sync-status.syncing {
            background: rgba(255, 193, 7, 0.9);
            color: black;
        }

        .sync-status.success {
            background: rgba(0, 255, 136, 0.9);
            color: black;
        }

        .sync-status.error {
            background: rgba(255, 68, 68, 0.9);
        }

        /* Login Modal */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active {
            display: flex;
        }

        .login-container {
            background: rgba(26, 26, 46, 0.95);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 20px;
            padding: 3rem 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0, 255, 136, 0.2);
            position: relative;
        }

        .login-logo {
            width: 200px;
            height: auto;
            margin-bottom: 2rem;
            filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.3));
        }

        .login-title {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #00ff88, #007bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-input {
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .login-input:focus {
            border-color: #00ff88;
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.2);
        }

        .login-btn {
            padding: 15px;
            background: linear-gradient(135deg, #00ff88, #007bff);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.3);
        }

        .login-error {
            color: #ff4444;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .login-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .login-close:hover {
            color: #ffffff;
        }

        /* Header */
        header {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-image {
            height: 60px;
            width: auto;
            filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.3));
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff88, #007bff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .logo-slogan {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
            margin-top: -2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .social-links {
            display: flex;
            gap: 12px;
        }

        .social-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 1.2rem;
        }

        .social-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .social-btn.whatsapp:hover {
            background: #25d366;
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
        }

        .social-btn.instagram:hover {
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            box-shadow: 0 8px 25px rgba(225, 48, 108, 0.4);
        }

        .social-btn.email:hover {
            background: #007bff;
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
        }

        .admin-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #8a2be2, #6a1b9a);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.4);
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-input:focus {
            border-color: #00ff88;
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        /* Navigation */
        .nav-categories {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .category-btn:hover,
        .category-btn.active {
            background: linear-gradient(135deg, #00ff88, #007bff);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }

        /* Sync Controls */
        .sync-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .sync-btn {
            padding: 8px 16px;
            background: rgba(0, 123, 255, 0.2);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 12px;
            color: #007bff;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .sync-btn:hover {
            background: rgba(0, 123, 255, 0.3);
            transform: translateY(-2px);
        }

        .sync-btn.syncing {
            background: rgba(255, 193, 7, 0.2);
            border-color: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }

        /* Main Content */
        main {
            padding: 3rem 0;
        }

        .hero-section {
            text-align: center;
            padding: 2rem 0 4rem;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff, #00ff88, #007bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            padding: 2rem 0;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00ff88, #007bff, #8a2be2);
        }

        .product-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(0, 255, 136, 0.3);
            box-shadow: 0 20px 40px rgba(0, 255, 136, 0.2);
        }

        .product-card.syncing {
            border-color: rgba(255, 193, 7, 0.5);
            background: rgba(255, 193, 7, 0.05);
        }

        .product-card.synced {
            border-color: rgba(0, 255, 136, 0.5);
            background: rgba(0, 255, 136, 0.05);
        }

        .product-image {
            width: 100%;
            height: 220px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-image.placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-size: 3rem;
        }

        .product-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: #ffffff;
            line-height: 1.3;
        }

        .product-price {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff88, #007bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .product-meta {
            display: flex;
            gap: 8px;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
        }

        .meta-tag {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid;
        }

        .meta-tag.nuevo {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            border-color: rgba(0, 255, 136, 0.3);
        }

        .meta-tag.usado {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border-color: rgba(255, 193, 7, 0.3);
        }

        .meta-tag.tecnologia {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
            border-color: rgba(0, 123, 255, 0.3);
        }

        .meta-tag.hogar {
            background: rgba(138, 43, 226, 0.1);
            color: #8a2be2;
            border-color: rgba(138, 43, 226, 0.3);
        }

        .meta-tag.mascotas {
            background: rgba(255, 20, 147, 0.1);
            color: #ff1493;
            border-color: rgba(255, 20, 147, 0.3);
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
        }

        .stars {
            color: #ffc107;
            font-size: 1.1rem;
        }

        .rating-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .condition-section {
            margin-bottom: 1.5rem;
        }

        .condition-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .condition-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .condition-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .condition-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-20px); }
            100% { transform: translateX(20px); }
        }

        .condition-excelente { 
            background: linear-gradient(90deg, #00ff88, #00cc6a);
        }
        .condition-muy-bueno { 
            background: linear-gradient(90deg, #00bcd4, #0097a7);
        }
        .condition-bueno { 
            background: linear-gradient(90deg, #ffc107, #ff9800);
        }
        .condition-regular { 
            background: linear-gradient(90deg, #ff9800, #f57c00);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .whatsapp-btn {
            flex: 1;
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .whatsapp-btn:hover {
            background: linear-gradient(135deg, #128c7e, #0d6e56);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.3);
        }

        .contact-options {
            display: flex;
            gap: 8px;
        }

        .contact-btn {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.1rem;
        }

        .contact-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .contact-btn.instagram:hover {
            background: linear-gradient(135deg, #e1306c, #fd1d1d, #fcb045);
            border-color: transparent;
        }

        .contact-btn.email:hover {
            background: linear-gradient(135deg, #007bff, #0056b3);
            border-color: transparent;
        }

        /* Delete button for admin */
        .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            border: none;
            color: white;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        .product-card.admin-mode .delete-btn {
            display: flex;
        }

        /* Sync indicator */
        .sync-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .sync-indicator.offline {
            background: #6c757d;
        }

        .sync-indicator.syncing {
            background: #ffc107;
            animation: pulse 1s infinite;
        }

        .sync-indicator.error {
            background: #ff4444;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
        }

        .admin-panel.active {
            display: block;
        }

        .admin-panel h2 {
            color: #ffffff;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .admin-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .admin-control-btn {
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .admin-control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        /* Image Upload Styles */
        .image-upload-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .image-upload-wrapper {
            border: 2px dashed rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .image-upload-wrapper:hover {
            border-color: rgba(0, 255, 136, 0.6);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .image-upload-wrapper.dragover {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: rgba(0, 255, 136, 0.6);
            margin-bottom: 1rem;
            display: block;
        }

        .upload-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 1rem;
            border: 2px solid rgba(0, 255, 136, 0.3);
            display: none;
        }

        .image-preview.show {
            display: block;
        }

        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .remove-image:hover {
            background: #ff4444;
            transform: scale(1.1);
        }

        .remove-image.show {
            display: flex;
        }

        .image-file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #00ff88, #007bff);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.3);
        }

        .logout-btn {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.4);
        }

        /* Admin indicator */
        .admin-indicator {
            position: fixed;
            top: 60px;
            left: 20px;
            background: linear-gradient(135deg, #8a2be2, #6a1b9a);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: none;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .admin-indicator.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .search-bar {
                max-width: 100%;
            }

            .nav-categories {
                gap: 10px;
                margin: 15px 0;
            }

            .category-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .products-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .social-links {
                gap: 8px;
            }

            .social-btn {
                width: 35px;
                height: 35px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .logo-image {
                height: 50px;
            }

            .logo {
                font-size: 1.5rem;
            }

            .logo-slogan {
                font-size: 0.6rem;
            }

            .admin-controls {
                justify-content: center;
            }

            .image-upload-wrapper {
                padding: 1.5rem;
            }

            .upload-icon {
                font-size: 2rem;
            }

            .connection-status, .sync-status {
                position: relative;
                margin: 10px;
            }
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="bg-animation"></div>
    
    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">
        üîÑ Iniciando conexi√≥n...
    </div>

    <!-- Sync Status -->
    <div class="sync-status" id="syncStatus">
        Sincronizando...
    </div>

    <!-- Admin Indicator -->
    <div class="admin-indicator" id="adminIndicator">
        üîê Modo Administrador Activo
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <button class="login-close" onclick="closeLogin()">&times;</button>
            
            <!-- Logo CompraDirectaDSM -->
            <svg class="login-logo" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#007bff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#8a2be2;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- Shopping bag icon -->
                <path d="M100 80 L120 60 L280 60 L300 80 L300 160 L100 160 Z" fill="url(#logoGradient)" opacity="0.8"/>
                <path d="M120 80 L120 50 Q120 40 130 40 L270 40 Q280 40 280 50 L280 80" fill="none" stroke="url(#logoGradient)" stroke-width="3"/>
                <circle cx="150" cy="100" r="15" fill="white" opacity="0.9"/>
                <circle cx="200" cy="100" r="15" fill="white" opacity="0.9"/>
                <circle cx="250" cy="100" r="15" fill="white" opacity="0.9"/>
                
                <!-- Text -->
                <text x="200" y="185" text-anchor="middle" fill="white" font-family="Arial Black" font-size="20" font-weight="bold">COMPRA DIRECTA DSM</text>
            </svg>
            
            <div class="login-title">Acceso Administrativo</div>
            
            <form class="login-form" id="loginForm">
                <input type="text" class="login-input" placeholder="Usuario" id="username" required>
                <input type="password" class="login-input" placeholder="Contrase√±a" id="password" required>
                <button type="submit" class="login-btn">üîê Iniciar Sesi√≥n</button>
                <div class="login-error" id="loginError">Usuario o contrase√±a incorrectos</div>
            </form>
        </div>
    </div>
    
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <!-- Logo CompraDirectaDSM actualizado -->
                    <svg class="logo-image" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="headerLogoGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#007bff;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#8a2be2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Shopping bag icon -->
                        <path d="M100 80 L120 60 L280 60 L300 80 L300 160 L100 160 Z" fill="url(#headerLogoGradient)" opacity="0.8"/>
                        <path d="M120 80 L120 50 Q120 40 130 40 L270 40 Q280 40 280 50 L280 80" fill="none" stroke="url(#headerLogoGradient)" stroke-width="3"/>
                        <circle cx="150" cy="100" r="15" fill="white" opacity="0.9"/>
                        <circle cx="200" cy="100" r="15" fill="white" opacity="0.9"/>
                        <circle cx="250" cy="100" r="15" fill="white" opacity="0.9"/>
                        
                        <!-- Text -->
                        <text x="200" y="185" text-anchor="middle" fill="white" font-family="Arial Black" font-size="20" font-weight="bold">COMPRA DIRECTA DSM</text>
                    </svg>
                    
                    <div class="logo-text">
                        <div class="logo">COMPRA DIRECTA DSM</div>
                        <div class="logo-slogan">Compra Directa, soluciones confiables</div>
                    </div>
                </div>
                <div class="search-bar">
                    <input type="text" id="searchInput" class="search-input" placeholder="üîç Buscar productos...">
                </div>
                <div class="header-actions">
                    <div class="sync-controls">
                        <button class="sync-btn" id="syncBtn" onclick="forceSyncNow()">üîÑ Sincronizar</button>
                    </div>
                    <div class="social-links">
                        <a href="https://wa.me/573222213453" class="social-btn whatsapp" title="WhatsApp">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.525 3.488"/>
                            </svg>
                        </a>
                        <a href="https://instagram.com/compradirectadsm" class="social-btn instagram" title="Instagram">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a href="mailto:contacto@compradirectadsm.com" class="social-btn email" title="Email">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                        </a>
                    </div>
                    <button class="admin-btn" id="adminLoginBtn" onclick="showLogin()">üë§ Admin</button>
                    <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">üö™ Salir</button>
                </div>
            </div>
            <nav class="nav-categories">
                <button class="category-btn active" data-category="all">üåü Todos</button>
                <button class="category-btn" data-category="tecnologia">üíª Tecnolog√≠a</button>
                <button class="category-btn" data-category="hogar">üè† Hogar</button>
                <button class="category-btn" data-category="mascotas">üêæ Mascotas</button>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Hero Section -->
            <section class="hero-section">
                <h1 class="hero-title">Tecnolog√≠a que Conecta</h1>
                <p class="hero-subtitle">Descubre productos innovadores con sincronizaci√≥n en tiempo real entre todos tus dispositivos. Compra directa, soluciones confiables.</p>
            </section>

            <!-- Admin Panel -->
            <section class="admin-panel" id="adminPanel">
                <h2>‚öôÔ∏è Panel de Administraci√≥n - Sistema H√≠brido</h2>
                
                <!-- Admin Controls -->
                <div class="admin-controls">
                    <button class="admin-control-btn" onclick="exportProducts()">üì• Exportar Productos</button>
                    <button class="admin-control-btn" onclick="importProducts()">üì§ Importar Productos</button>
                    <button class="admin-control-btn" onclick="clearAllData()">üóëÔ∏è Limpiar Todo</button>
                    <button class="admin-control-btn" onclick="forceSyncNow()">‚òÅÔ∏è Sincronizar Ahora</button>
                    <span class="admin-control-btn" style="background: rgba(0, 255, 136, 0.2); cursor: default;">
                        üìä Total: <span id="productCount">0</span> productos
                    </span>
                </div>
                
                <form id="productForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">Nombre del Producto</label>
                            <input type="text" id="productName" placeholder="Ej: iPhone 15 Pro Max" required>
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Precio (COP)</label>
                            <input type="number" id="productPrice" min="0" step="1000" placeholder="1500000" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productCategory">Categor√≠a</label>
                            <select id="productCategory" required>
                                <option value="">Seleccionar categor√≠a</option>
                                <option value="tecnologia">Tecnolog√≠a</option>
                                <option value="hogar">Hogar</option>
                                <option value="mascotas">Mascotas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productCondition">Estado</label>
                            <select id="productCondition" required>
                                <option value="">Seleccionar estado</option>
                                <option value="nuevo">Nuevo</option>
                                <option value="usado">Usado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productQuality">Condici√≥n (1-5)</label>
                            <select id="productQuality" required>
                                <option value="">Seleccionar</option>
                                <option value="5">Excelente (5)</option>
                                <option value="4">Muy Bueno (4)</option>
                                <option value="3">Bueno (3)</option>
                                <option value="2">Regular (2)</option>
                                <option value="1">Malo (1)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="productRating">Calificaci√≥n Usuario (1-5)</label>
                            <select id="productRating" required>
                                <option value="">Seleccionar</option>
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4)</option>
                                <option value="3">‚≠ê‚≠ê‚≠ê (3)</option>
                                <option value="2">‚≠ê‚≠ê (2)</option>
                                <option value="1">‚≠ê (1)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Image Upload Section -->
                    <div class="form-group">
                        <label for="productImage">Imagen del Producto</label>
                        <div class="image-upload-container">
                            <div class="image-upload-wrapper" onclick="document.getElementById('productImageFile').click()">
                                <span class="upload-icon">üì∏</span>
                                <div class="upload-text">Subir Imagen</div>
                                <div class="upload-hint">Haz click o arrastra una imagen</div>
                                <img id="imagePreview" class="image-preview" alt="Vista previa">
                            </div>
                            <button type="button" class="remove-image" id="removeImageBtn" onclick="removeImage()">√ó</button>
                            <input type="file" id="productImageFile" class="image-file-input" accept="image/*">
                        </div>
                    </div>

                    <button type="submit" class="btn">‚ú® Agregar Producto</button>
                </form>
            </section>

            <!-- Products Grid -->
            <section class="products-grid" id="productsGrid">
                <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
            </section>

            <!-- Empty State -->
            <section class="empty-state" id="emptyState">
                <h3>üõçÔ∏è ¬°Comienza agregando productos!</h3>
                <p>Tu cat√°logo est√° vac√≠o. Inicia sesi√≥n como administrador para agregar productos incre√≠bles.</p>
            </section>
        </div>
    </main>

    <input type="file" id="importInput" accept=".json" style="display: none;">

    <script>
        // ========================
        // CONFIGURACI√ìN FIREBASE
        // ========================
        
        // REEMPLAZA ESTA CONFIGURACI√ìN CON LA TUYA DE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBOZ2oyzry1lHeE4ciBB9ROn0gITao_kuw",
            authDomain: "compradirectadsm-45184.firebaseapp.com",
            projectId: "compradirectadsm-45184",
            storageBucket: "compradirectadsm-45184.firebasestorage.app",
            messagingSenderId: "290853773930",
            appId: "1:290853773930:web:b6462692f76705b44ce013"
        };

        // Variables globales Firebase
        let db = null;
        let firebaseInitialized = false;
        let firebaseError = false;

        // Intentar inicializar Firebase
        function initializeFirebase() {
            try {
                console.log("üîÑ Inicializando Firebase...");
                
                // Inicializar Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                // Configurar configuraciones para mejor rendimiento
                db.settings({
                    cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
                });
                
                // Habilitar persistencia offline
                db.enablePersistence().catch((err) => {
                    if (err.code == 'failed-precondition') {
                        console.warn("Persistencia no habilitada: m√∫ltiples pesta√±as abiertas");
                    } else if (err.code == 'unimplemented') {
                        console.warn("Persistencia no soportada por el navegador");
                    }
                });
                
                firebaseInitialized = true;
                
                console.log("‚úÖ Firebase inicializado correctamente");
                updateConnectionStatus(true, "Conectado a Firebase - Sincronizaci√≥n activa");
                return true;
                
            } catch (error) {
                console.error("‚ùå Error al inicializar Firebase:", error);
                firebaseError = true;
                updateConnectionStatus(false, "Error de conexi√≥n Firebase - Solo modo local");
                return false;
            }
        }

        // ========================
        // VARIABLES GLOBALES
        // ========================
        
        const STORAGE_KEY = 'compradirectadsm_products';
        const SETTINGS_KEY = 'compradirectadsm_settings';
        const SYNC_KEY = 'compradirectadsm_last_sync';
        
        let products = [];
        let filteredProducts = [];
        let currentCategory = 'all';
        let nextId = 1;
        let isOnline = navigator.onLine;
        let lastSyncTime = null;
        let syncInProgress = false;

        // Estados de autenticaci√≥n
        let isAdminLoggedIn = false;
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'Cc1033730977';

        // Referencias DOM
        const loginModal = document.getElementById('loginModal');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const adminPanel = document.getElementById('adminPanel');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminIndicator = document.getElementById('adminIndicator');
        const productsGrid = document.getElementById('productsGrid');
        const emptyState = document.getElementById('emptyState');
        const searchInput = document.getElementById('searchInput');
        const categoryBtns = document.querySelectorAll('.category-btn');
        const importInput = document.getElementById('importInput');
        const connectionStatus = document.getElementById('connectionStatus');
        const syncStatus = document.getElementById('syncStatus');
        const syncBtn = document.getElementById('syncBtn');
        const productForm = document.getElementById('productForm');

        // ========================
        // FUNCIONES FIREBASE
        // ========================
        
        async function saveToFirebase(products) {
            if (!firebaseInitialized || !db) {
                console.warn("Firebase no est√° inicializado");
                return false;
            }

            try {
                showSyncStatus('Guardando en Firebase...', 'syncing');
                
                const batch = db.batch();
                
                // Crear o actualizar cada producto
                products.forEach(product => {
                    const docRef = db.collection('products').doc(product.id.toString());
                    batch.set(docRef, {
                        ...product,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });
                
                // Guardar metadatos
                const metaRef = db.collection('metadata').doc('products');
                batch.set(metaRef, {
                    totalProducts: products.length,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    nextId: nextId
                });

                await batch.commit();
                
                showSyncStatus('Guardado en Firebase', 'success');
                console.log(`‚úÖ ${products.length} productos sincronizados con Firebase`);
                return true;
                
            } catch (error) {
                console.error("Error al guardar en Firebase:", error);
                showSyncStatus('Error al guardar en Firebase', 'error');
                return false;
            }
        }

        async function loadFromFirebase() {
            if (!firebaseInitialized || !db) {
                return [];
            }

            try {
                showSyncStatus('Cargando desde Firebase...', 'syncing');
                
                const snapshot = await db.collection('products').get();
                const firebaseProducts = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    firebaseProducts.push({
                        ...data,
                        id: parseInt(doc.id)
                    });
                });
                
                // Cargar metadatos
                const metaDoc = await db.collection('metadata').doc('products').get();
                if (metaDoc.exists) {
                    const metaData = metaDoc.data();
                    if (metaData.nextId) {
                        nextId = metaData.nextId;
                    }
                }
                
                showSyncStatus('Cargado desde Firebase', 'success');
                console.log(`‚úÖ ${firebaseProducts.length} productos cargados desde Firebase`);
                return firebaseProducts;
                
            } catch (error) {
                console.error("Error al cargar desde Firebase:", error);
                showSyncStatus('Error al cargar desde Firebase', 'error');
                return [];
            }
        }

        async function syncWithFirebase() {
            if (!firebaseInitialized || syncInProgress) {
                return false;
            }
            
            syncInProgress = true;
            updateSyncButton(true);
            
            try {
                console.log("üîÑ Iniciando sincronizaci√≥n con Firebase...");
                
                // Cargar productos desde Firebase
                const firebaseProducts = await loadFromFirebase();
                
                // Si Firebase tiene productos, usarlos
                if (firebaseProducts.length > 0) {
                    products = firebaseProducts;
                    saveProductsToStorage(); // Tambi√©n guardar localmente
                    console.log(`üì• ${firebaseProducts.length} productos sincronizados desde Firebase`);
                }
                
                // Si tenemos productos locales pero Firebase est√° vac√≠o, subirlos
                else if (products.length > 0) {
                    await saveToFirebase(products);
                    console.log(`üì§ ${products.length} productos enviados a Firebase`);
                }
                
                lastSyncTime = new Date();
                localStorage.setItem(SYNC_KEY, lastSyncTime.toISOString());
                
                updateProductCount();
                filterProducts();
                updateProductSyncIndicators();
                
                syncInProgress = false;
                updateSyncButton(false);
                
                console.log("‚úÖ Sincronizaci√≥n completada exitosamente");
                showSyncStatus('Sincronizaci√≥n completada', 'success');
                return true;
                
            } catch (error) {
                console.error("Error en sincronizaci√≥n:", error);
                showSyncStatus('Error de sincronizaci√≥n', 'error');
                syncInProgress = false;
                updateSyncButton(false);
                return false;
            }
        }

        // ========================
        // FUNCIONES DE CONEXI√ìN Y SINCRONIZACI√ìN
        // ========================
        
        function updateConnectionStatus(connected = null, message = null) {
            const status = connected !== null ? connected : (firebaseInitialized && isOnline);
            
            if (status && firebaseInitialized) {
                connectionStatus.className = 'connection-status';
                connectionStatus.innerHTML = '‚úÖ Conectado a Firebase - Sincronizaci√≥n activa';
            } else if (firebaseError) {
                connectionStatus.className = 'connection-status error';
                connectionStatus.innerHTML = '‚ùå Error de Firebase - Solo modo local';
            } else if (!firebaseInitialized) {
                connectionStatus.className = 'connection-status error';
                connectionStatus.innerHTML = '‚ö†Ô∏è Firebase no inicializado - Solo modo local';
            } else {
                connectionStatus.className = 'connection-status offline';
                connectionStatus.innerHTML = 'üì° Sin conexi√≥n - Modo offline activado';
            }
        }

        function showSyncStatus(message, type = 'info', duration = 3000) {
            syncStatus.textContent = message;
            syncStatus.className = `sync-status show ${type}`;
            
            setTimeout(() => {
                syncStatus.classList.remove('show');
            }, duration);
        }

        function updateSyncButton(syncing = false) {
            if (syncing) {
                syncBtn.textContent = 'üîÑ Sincronizando...';
                syncBtn.classList.add('syncing');
                syncBtn.disabled = true;
            } else {
                syncBtn.textContent = 'üîÑ Sincronizar';
                syncBtn.classList.remove('syncing');
                syncBtn.disabled = false;
            }
        }

        // ========================
        // FUNCIONES DE ALMACENAMIENTO LOCAL
        // ========================
        
        function loadProductsFromStorage() {
            try {
                const savedProducts = localStorage.getItem(STORAGE_KEY);
                if (savedProducts) {
                    const parsedProducts = JSON.parse(savedProducts);
                    if (Array.isArray(parsedProducts) && parsedProducts.length > 0) {
                        console.log(`üìÅ Cargados ${parsedProducts.length} productos desde localStorage`);
                        return parsedProducts;
                    }
                }
            } catch (error) {
                console.error('Error al cargar productos desde localStorage:', error);
                showSyncStatus('Error al cargar datos locales', 'error');
            }
            return [];
        }
        
        function saveProductsToStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
                localStorage.setItem(SETTINGS_KEY, JSON.stringify({
                    lastUpdated: new Date().toISOString(),
                    totalProducts: products.length,
                    nextId: nextId
                }));
                console.log(`üíæ ${products.length} productos guardados en localStorage`);
                return true;
            } catch (error) {
                console.error('Error al guardar productos:', error);
                showSyncStatus('Error al guardar datos locales', 'error');
                return false;
            }
        }

        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem(SETTINGS_KEY);
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    if (settings.nextId) {
                        nextId = settings.nextId;
                    }
                    return settings;
                }
            } catch (error) {
                console.error('Error al cargar configuraciones:', error);
            }
            return null;
        }

        // ========================
        // FUNCIONES DE AUTENTICACI√ìN
        // ========================
        
        function showLogin() {
            loginModal.classList.add('active');
            document.getElementById('username').focus();
        }

        function closeLogin() {
            loginModal.classList.remove('active');
            loginError.style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function login(username, password) {
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                adminPanel.classList.add('active');
                adminLoginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
                adminIndicator.classList.add('active');
                closeLogin();
                showSyncStatus('‚úÖ Sesi√≥n administrativa iniciada', 'success');
                toggleAdminMode(true);
                return true;
            } else {
                loginError.style.display = 'block';
                return false;
            }
        }

        function logout() {
            isAdminLoggedIn = false;
            adminPanel.classList.remove('active');
            adminLoginBtn.style.display = 'inline-block';
            logoutBtn.style.display = 'none';
            adminIndicator.classList.remove('active');
            toggleAdminMode(false);
            showSyncStatus('üëã Sesi√≥n cerrada', 'info');
        }

        function toggleAdminMode(enabled) {
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                if (enabled) {
                    card.classList.add('admin-mode');
                } else {
                    card.classList.remove('admin-mode');
                }
            });
        }

        // ========================
        // FUNCIONES DE GESTI√ìN DE PRODUCTOS
        // ========================
        
        function generateId() {
            return nextId++;
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(price);
        }

        function getConditionClass(quality) {
            switch(parseInt(quality)) {
                case 5: return 'condition-excelente';
                case 4: return 'condition-muy-bueno';
                case 3: return 'condition-bueno';
                case 2: 
                case 1: return 'condition-regular';
                default: return 'condition-bueno';
            }
        }

        function getConditionLabel(quality) {
            switch(parseInt(quality)) {
                case 5: return 'Excelente';
                case 4: return 'Muy Bueno';
                case 3: return 'Bueno';
                case 2: return 'Regular';
                case 1: return 'Malo';
                default: return 'Bueno';
            }
        }

        function generateStars(rating) {
            const fullStars = parseInt(rating);
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '‚≠ê';
            }
            return stars;
        }

        function createProductCard(product) {
            const whatsappMessage = encodeURIComponent(
                `¬°Hola! Me interesa este producto:\n\n` +
                `${product.name}\n` +
                `${formatPrice(product.price)}\n` +
                `Estado: ${product.condition}\n` +
                `Calificaci√≥n: ${generateStars(product.rating)}\n\n` +
                `¬øPodr√≠as darme m√°s informaci√≥n?`
            );

            const whatsappUrl = `https://wa.me/573222213453?text=${whatsappMessage}`;
            const instagramUrl = `https://instagram.com/compradirectadsm`;
            const emailSubject = encodeURIComponent(`Consulta sobre: ${product.name}`);
            const emailBody = encodeURIComponent(`Hola, me interesa el producto ${product.name} por ${formatPrice(product.price)}. ¬øPodr√≠an darme m√°s informaci√≥n?`);
            const emailUrl = `mailto:contacto@compradirectadsm.com?subject=${emailSubject}&body=${emailBody}`;

            return `
                <div class="product-card" data-category="${product.category}" data-id="${product.id}">
                    <div class="sync-indicator" title="Estado de sincronizaci√≥n"></div>
                    <button class="delete-btn" onclick="deleteProduct(${product.id})" title="Eliminar producto">üóëÔ∏è</button>
                    
                    <div class="product-image ${product.image ? '' : 'placeholder'}">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" loading="lazy">` : 
                            'üì¶'
                        }
                    </div>
                    
                    <h3 class="product-title">${product.name}</h3>
                    <div class="product-price">${formatPrice(product.price)}</div>
                    
                    <div class="product-meta">
                        <span class="meta-tag ${product.condition}">${product.condition}</span>
                        <span class="meta-tag ${product.category}">${product.category}</span>
                    </div>
                    
                    <div class="rating">
                        <span class="stars">${generateStars(product.rating)}</span>
                        <span class="rating-text">(${product.rating}/5)</span>
                    </div>
                    
                    <div class="condition-section">
                        <div class="condition-label">Condici√≥n: ${getConditionLabel(product.quality)}</div>
                        <div class="condition-bar">
                            <div class="condition-fill ${getConditionClass(product.quality)}" 
                                 style="width: ${(product.quality * 20)}%"></div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <a href="${whatsappUrl}" class="whatsapp-btn" target="_blank">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.525 3.488"/>
                            </svg>
                            WhatsApp
                        </a>
                        
                        <div class="contact-options">
                            <a href="${instagramUrl}" class="contact-btn instagram" target="_blank" title="Instagram">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                </svg>
                            </a>
                            <a href="${emailUrl}" class="contact-btn email" title="Email">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        async function addProduct(productData) {
            const product = {
                id: generateId(),
                name: productData.name,
                price: parseInt(productData.price),
                category: productData.category,
                condition: productData.condition,
                quality: parseInt(productData.quality),
                rating: parseInt(productData.rating),
                image: productData.image || null,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            products.push(product);
            saveProductsToStorage();
            updateProductCount();
            
            // Sincronizar con Firebase si est√° disponible
            if (firebaseInitialized && isOnline) {
                await saveToFirebase(products);
            }
            
            filterProducts();
            showSyncStatus('‚úÖ Producto agregado exitosamente', 'success');
            
            return product;
        }

        async function deleteProduct(productId) {
            if (confirm('¬øEst√°s seguro de que deseas eliminar este producto?')) {
                const index = products.findIndex(p => p.id === productId);
                if (index !== -1) {
                    const product = products[index];
                    products.splice(index, 1);
                    saveProductsToStorage();
                    updateProductCount();
                    
                    // Eliminar de Firebase si est√° disponible
                    if (firebaseInitialized && db && isOnline) {
                        try {
                            await db.collection('products').doc(productId.toString()).delete();
                            showSyncStatus(`‚úÖ "${product.name}" eliminado y sincronizado`, 'success');
                        } catch (error) {
                            console.error('Error al eliminar de Firebase:', error);
                            showSyncStatus(`‚ö†Ô∏è "${product.name}" eliminado localmente`, 'info');
                        }
                    } else {
                        showSyncStatus(`üóëÔ∏è "${product.name}" eliminado`, 'info');
                    }
                    
                    filterProducts();
                }
            }
        }

        function updateProductCount() {
            const countElement = document.getElementById('productCount');
            if (countElement) {
                countElement.textContent = products.length;
            }
        }

        // ========================
        // FUNCIONES DE FILTRADO Y B√öSQUEDA
        // ========================
        
        function filterProducts() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            filteredProducts = products.filter(product => {
                const matchesCategory = currentCategory === 'all' || product.category === currentCategory;
                const matchesSearch = !searchTerm || 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm) ||
                    product.condition.toLowerCase().includes(searchTerm);
                
                return matchesCategory && matchesSearch;
            });

            renderProducts();
        }

        function renderProducts() {
            if (filteredProducts.length === 0) {
                productsGrid.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                productsGrid.style.display = 'grid';
                emptyState.style.display = 'none';
                
                productsGrid.innerHTML = filteredProducts
                    .map(product => createProductCard(product))
                    .join('');
                
                // Aplicar modo admin si est√° activo
                if (isAdminLoggedIn) {
                    toggleAdminMode(true);
                }
                
                // Actualizar indicadores de sincronizaci√≥n
                updateProductSyncIndicators();
            }
        }

        function updateProductSyncIndicators() {
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                const indicator = card.querySelector('.sync-indicator');
                if (indicator) {
                    if (firebaseInitialized && isOnline && lastSyncTime) {
                        indicator.className = 'sync-indicator';
                        indicator.title = `Sincronizado: ${lastSyncTime.toLocaleString()}`;
                    } else if (!isOnline) {
                        indicator.className = 'sync-indicator offline';
                        indicator.title = 'Sin conexi√≥n - Solo local';
                    } else if (!firebaseInitialized) {
                        indicator.className = 'sync-indicator error';
                        indicator.title = 'Firebase no inicializado - Solo local';
                    }
                }
            });
        }

        // ========================
        // FUNCIONES DE MANEJO DE ARCHIVOS
        // ========================
        
        function handleImageUpload(file) {
            return new Promise((resolve, reject) => {
                if (!file) {
                    resolve(null);
                    return;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB m√°ximo
                    reject(new Error('La imagen es demasiado grande. M√°ximo 5MB.'));
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    resolve(e.target.result);
                };
                reader.onerror = () => {
                    reject(new Error('Error al leer la imagen'));
                };
                reader.readAsDataURL(file);
            });
        }

        // ========================
        // FUNCIONES DE IMPORTACI√ìN/EXPORTACI√ìN
        // ========================
        
        function exportProducts() {
            if (products.length === 0) {
                showSyncStatus('No hay productos para exportar', 'error');
                return;
            }

            const exportData = {
                products: products,
                metadata: {
                    exportDate: new Date().toISOString(),
                    totalProducts: products.length,
                    version: '1.0',
                    source: 'CompraDirectaDSM'
                }
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `compradirectadsm_productos_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showSyncStatus('üì• Productos exportados exitosamente', 'success');
        }

        function importProducts() {
            importInput.click();
        }

        async function clearAllData() {
            const confirmMessage = 'ADVERTENCIA: Esta acci√≥n eliminar√° TODOS los productos.\n\n¬øEst√°s absolutamente seguro?';
            
            if (confirm(confirmMessage)) {
                const doubleConfirm = prompt('Para confirmar, escribe "ELIMINAR TODO" (sin comillas):');
                
                if (doubleConfirm === 'ELIMINAR TODO') {
                    products = [];
                    filteredProducts = [];
                    nextId = 1;
                    
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(SETTINGS_KEY);
                    localStorage.removeItem(SYNC_KEY);
                    
                    // Limpiar Firebase si est√° disponible
                    if (firebaseInitialized && db && isOnline) {
                        try {
                            const batch = db.batch();
                            const snapshot = await db.collection('products').get();
                            snapshot.docs.forEach(doc => {
                                batch.delete(doc.ref);
                            });
                            await batch.commit();
                            
                            await db.collection('metadata').doc('products').delete();
                            showSyncStatus('üóëÔ∏è Todos los datos eliminados (local y Firebase)', 'info');
                        } catch (error) {
                            console.error('Error al limpiar Firebase:', error);
                            showSyncStatus('üóëÔ∏è Datos locales eliminados', 'info');
                        }
                    } else {
                        showSyncStatus('üóëÔ∏è Todos los datos locales eliminados', 'info');
                    }
                    
                    updateProductCount();
                    renderProducts();
                } else {
                    showSyncStatus('‚ùå Eliminaci√≥n cancelada', 'error');
                }
            }
        }

        // ========================
        // FUNCIONES DE INTERFAZ DE USUARIO
        // ========================
        
        async function submitProduct(e) {
            e.preventDefault();
            
            const form = {
                name: document.getElementById('productName').value.trim(),
                price: document.getElementById('productPrice').value,
                category: document.getElementById('productCategory').value,
                condition: document.getElementById('productCondition').value,
                quality: document.getElementById('productQuality').value,
                rating: document.getElementById('productRating').value
            };

            // Validaciones
            if (!form.name || !form.price || !form.category || !form.condition || !form.quality || !form.rating) {
                showSyncStatus('‚ùå Por favor completa todos los campos', 'error');
                return;
            }

            if (form.price <= 0) {
                showSyncStatus('‚ùå El precio debe ser mayor a 0', 'error');
                return;
            }

            // Manejar imagen
            const imageFile = document.getElementById('productImageFile').files[0];
            
            try {
                if (imageFile) {
                    form.image = await handleImageUpload(imageFile);
                }
                
                await addProduct(form);
                clearProductForm();
                
            } catch (error) {
                showSyncStatus(`‚ùå Error con la imagen: ${error.message}`, 'error');
            }
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productCondition').value = '';
            document.getElementById('productQuality').value = '';
            document.getElementById('productRating').value = '';
            removeImage();
        }

        function removeImage() {
            const preview = document.getElementById('imagePreview');
            const removeBtn = document.getElementById('removeImageBtn');
            const fileInput = document.getElementById('productImageFile');
            
            preview.src = '';
            preview.classList.remove('show');
            removeBtn.classList.remove('show');
            fileInput.value = '';
        }

        async function forceSyncNow() {
            if (!firebaseInitialized) {
                showSyncStatus('‚ùå Firebase no est√° inicializado', 'error');
                return;
            }

            if (!isOnline) {
                showSyncStatus('‚ùå Sin conexi√≥n a internet', 'error');
                return;
            }

            await syncWithFirebase();
        }

        function handleImagePreview(file) {
            const preview = document.getElementById('imagePreview');
            const removeBtn = document.getElementById('removeImageBtn');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.classList.add('show');
                removeBtn.classList.add('show');
            };
            reader.readAsDataURL(file);
        }

        // ========================
        // EVENT LISTENERS
        // ========================
        
        // Autenticaci√≥n
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            login(username, password);
        });

        // Formulario de productos
        productForm.addEventListener('submit', submitProduct);

        // B√∫squeda
        searchInput.addEventListener('input', filterProducts);

        // Categor√≠as
        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remover clase active de todos los botones
                categoryBtns.forEach(b => b.classList.remove('active'));
                // Agregar clase active al bot√≥n clickeado
                btn.classList.add('active');
                
                currentCategory = btn.dataset.category;
                filterProducts();
            });
        });

        // Drag & Drop para im√°genes
        const imageUploadWrapper = document.querySelector('.image-upload-wrapper');
        
        imageUploadWrapper.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadWrapper.classList.add('dragover');
        });

        imageUploadWrapper.addEventListener('dragleave', () => {
            imageUploadWrapper.classList.remove('dragover');
        });

        imageUploadWrapper.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadWrapper.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                document.getElementById('productImageFile').files = files;
                handleImagePreview(files[0]);
            }
        });

        // Preview de imagen
        document.getElementById('productImageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleImagePreview(file);
            }
        });

        // Importaci√≥n de archivos
        importInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (event) => {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    if (importedData.products && Array.isArray(importedData.products)) {
                        const importCount = importedData.products.length;
                        
                        if (confirm(`¬øImportar ${importCount} productos? Esto se agregar√° a los productos existentes.`)) {
                            importedData.products.forEach(product => {
                                if (product.name && product.price) {
                                    product.id = generateId();
                                    product.updatedAt = new Date().toISOString();
                                    products.push(product);
                                }
                            });
                            
                            saveProductsToStorage();
                            updateProductCount();
                            filterProducts();
                            
                            showSyncStatus(`${importCount} productos importados`, 'success');
                            
                            // Sincronizar autom√°ticamente
                            if (firebaseInitialized && isOnline) {
                                setTimeout(() => syncWithFirebase(), 1000);
                            }
                        }
                    } else {
                        showSyncStatus('Formato de archivo inv√°lido', 'error');
                    }
                } catch (error) {
                    showSyncStatus('Error al leer el archivo', 'error');
                    console.error('Error de importaci√≥n:', error);
                }
            };
            reader.readAsText(file);
            
            // Limpiar input
            importInput.value = '';
        });

        // Detectar cambios de conectividad
        window.addEventListener('online', () => {
            isOnline = true;
            updateConnectionStatus();
            showSyncStatus('Conexi√≥n restaurada', 'success');
            
            // Intentar sincronizar autom√°ticamente al recuperar conexi√≥n
            if (firebaseInitialized && products.length > 0) {
                setTimeout(() => syncWithFirebase(), 2000);
            }
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            updateConnectionStatus();
            showSyncStatus('Sin conexi√≥n - Modo offline activado', 'info');
        });

        // ========================
        // FUNCIONES GLOBALES (para HTML onclick)
        // ========================
        
        window.showLogin = showLogin;
        window.closeLogin = closeLogin;
        window.logout = logout;
        window.deleteProduct = deleteProduct;
        window.exportProducts = exportProducts;
        window.importProducts = importProducts;
        window.clearAllData = clearAllData;
        window.forceSyncNow = forceSyncNow;
        window.removeImage = removeImage;

        // ========================
        // INICIALIZACI√ìN
        // ========================
        
        async function initialize() {
            console.log('Iniciando CompraDirectaDSM...');
            
            // Mostrar estado de inicializaci√≥n
            updateConnectionStatus(false, 'üîÑ Iniciando...');
            
            // Inicializar Firebase primero
            const firebaseReady = initializeFirebase();
            
            // Cargar configuraciones
            loadSettings();
            
            // Cargar productos desde localStorage
            products = loadProductsFromStorage();
            
            // Actualizar estado de conexi√≥n
            isOnline = navigator.onLine;
            updateConnectionStatus();
            
            // Si Firebase est√° listo y tenemos conexi√≥n, sincronizar
            if (firebaseReady && isOnline) {
                try {
                    console.log('üîÑ Iniciando sincronizaci√≥n autom√°tica...');
                    await syncWithFirebase();
                } catch (error) {
                    console.error('‚ùå Error en sincronizaci√≥n inicial:', error);
                    showSyncStatus('‚ö†Ô∏è Error en sincronizaci√≥n inicial', 'error');
                }
            }
            
            // Cargar tiempo de √∫ltima sincronizaci√≥n
            const lastSync = localStorage.getItem(SYNC_KEY);
            if (lastSync) {
                lastSyncTime = new Date(lastSync);
                console.log(`üìÖ √öltima sincronizaci√≥n: ${lastSyncTime.toLocaleString()}`);
            }
            
            // Renderizar productos iniciales
            currentCategory = 'all';
            filterProducts();
            updateProductCount();
            
            // Actualizar indicadores
            updateProductSyncIndicators();
            
            // Auto-sincronizaci√≥n cada 5 minutos si Firebase est√° configurado
            if (firebaseInitialized) {
                setInterval(() => {
                    if (isOnline && !syncInProgress && products.length > 0) {
                        console.log('‚è∞ Auto-sincronizaci√≥n programada...');
                        syncWithFirebase();
                    }
                }, 5 * 60 * 1000); // 5 minutos
                
                console.log('‚úÖ Auto-sincronizaci√≥n configurada (cada 5 minutos)');
            }
            
            console.log(`‚úÖ CompraDirectaDSM iniciado correctamente con ${products.length} productos`);
            
            // Mensaje de bienvenida
            setTimeout(() => {
                if (firebaseInitialized && isOnline) {
                    showSyncStatus('üöÄ Sistema iniciado con sincronizaci√≥n Firebase', 'success');
                } else if (firebaseInitialized && !isOnline) {
                    showSyncStatus('üöÄ Sistema iniciado - Firebase configurado (sin conexi√≥n)', 'info');
                } else {
                    showSyncStatus('üöÄ Sistema iniciado - Solo modo local', 'info');
                }
            }, 1000);
        }

        // Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

        // ========================
        // MANEJO DE ERRORES GLOBALES
        // ========================
        
        window.addEventListener('error', (e) => {
            console.error('Error global capturado:', e.error);
            showSyncStatus('‚ùå Error del sistema', 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Promise rechazada no manejada:', e.reason);
            showSyncStatus('‚ö†Ô∏è Error de operaci√≥n as√≠ncrona', 'error');
        });

        // ========================
        // DEBUG - Solo para desarrollo
        // ========================
        
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.debugCompraDirecta = {
                products: () => products,
                firebase: () => ({ initialized: firebaseInitialized, db: !!db }),
                sync: forceSyncNow,
                clear: () => { products = []; renderProducts(); },
                status: () => ({
                    products: products.length,
                    firebase: firebaseInitialized,
                    online: isOnline,
                    lastSync: lastSyncTime,
                    admin: isAdminLoggedIn
                })
            };
            console.log('üîß Modo debug activado. Usa window.debugCompraDirecta para herramientas de desarrollo.');
        }

    </script>
</body>
</html>